<!doctype html>
<html>
	<head>
		<title>Block report for void.cat</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
		<style>
			html {
				background-color: #888;
			}
			
			body {
				font-family: Arial;
				font-size: 12px;
				width: 400px;
				margin-left: auto;
				margin-right: auto;
				background-color: #eee;
				padding: 20px;
				border-radius: 3px;
			}
			
			table {
				width: 100%;
				text-align: center;
				border-collapse: collapse;
			}
			
			th, td {
			    padding: 5px;
			}
			
			thead {
				background-color: #333;
				color: #fff;
			}
		</style>
	</head>
	
	<body>
		<h3>Stats per country</h3>
		<canvas id="country-stats" width="400" height="400"></canvas>
		<h3>Top 10 blocked Ips</h3>
		<table>
			<thead>
				<tr>
					<th>Country</th>
					<th>Ip</th>
					<th>Hits</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
		
		<script>
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
				if(xhr.readyState === 4 && xhr.status === 200) {
					var IPS = JSON.parse(xhr.response);
					//load top 10 rows
					var tb = document.querySelector('table');
					for(var x = 0; x < 10; x++) {
						var nr = document.createElement('tr');
						nr.innerHTML = '<td><img height="20" src="https://raw.githubusercontent.com/hjnilsson/country-flags/master/png100px/' + IPS[x].country + '.png" title="' + IPS[x].country + '"/></td><td>' + IPS[x].ip + '</td><td>' + IPS[x].hits + '</td>';
						tb.tBodies[0].appendChild(nr);
					}
					
					var c_stats = new Map();
					
					for(var x = 0; x < IPS.length; x++) {
						var ct = IPS[x].country;
						if (c_stats.has(ct)) {
							c_stats.set(ct,c_stats.get(ct) + IPS[x].hits);
						}else {
							c_stats.set(ct, IPS[x].hits);
						}
					}
					
					var c_vals = Array.from(c_stats.entries()).sort((a,b) => { return a[1] < b[1] ? 1 : (a[1] > b[1] ? -1 : 0); }).slice(0, 10);
					new Chart("country-stats", {
						type: 'doughnut',
						data: {
							datasets: [{
								data: c_vals.map((a) => { return a[1] })
							}],
							labels: c_vals.map((a) => { return a[0] })
						},
						options: {}
					});
				}
			};
			xhr.open('GET', '/block.json', true);
			xhr.send();
			
		</script>
	</body>
</html>
