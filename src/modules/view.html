<link rel="import" href="/bower_components/polymer/polymer-element.html">
<dom-module id="void-view">
    <template>
		<style>
			img {
				max-width: 100%;
				display: block;
				margin-left: auto;
				margin-right: auto;
			}
			
			.file-info {
				margin-top: 10px;
				background-color: #1fa4ab;
				line-height: 30px;
				width: 300px;
				margin-left: auto;
				margin-right: auto;
				border-radius: 3px;
				padding: 5px 10px 5px 10px;
				overflow: hidden;
			}
			
			.file-info-views {
				float: left;
			}
			
			.file-info-size {
				float: right; 
			}
			
			.material-icons {
			  font-family: 'Material Icons';
			  font-weight: normal;
			  font-style: normal;
			  font-size: 25px;
			  float:left;
			  margin-right: 5px;
			  text-transform: none;
			  letter-spacing: normal;
			  word-wrap: normal;
			  white-space: nowrap;
			  direction: ltr;
			  -webkit-font-smoothing: antialiased;
			  text-rendering: optimizeLegibility;
			  -moz-osx-font-smoothing: grayscale;
			  font-feature-settings: 'liga';
			}
			
			audio, video {
				width: 100%;
			}
			
			.captcha { text-align: center; }
		</style>
		<template is="dom-if" if="[[isCaptcha]]">
			<div class="captcha">
				<h3>Oh no :( you downloaded this file [[captchaDL]] times, please verify you are human</h3>
			</div>
		</template>
		<template is="dom-if" if="[[isImage]]">
			<img src="[[fileInfo.url]]"/>
		</template>
		<template is="dom-if" if="[[isVideo]]">
			<video controls>
				<source src="[[fileInfo.url]]" type="[[fileInfo.mime]]">
			</video>
		</template>
		<template is="dom-if" if="[[isSound]]">
			<audio controls>
				<source src="[[fileInfo.url]]" type="[[fileInfo.mime]]">
			</audio>
		</template>
		<template is="dom-if" if="[[isDefault]]">
			<a href="[[fileInfo.url]]">Download [[fileInfo.filename]]</a>
		</template>
		<template is="dom-if" if="[[!isCaptcha]]">
			<div class="file-info">
				<div class="file-info-views">
					<div class="material-icons">cloud_download</div>Downloads: [[fileInfo.views]]
				</div>
				<div class="file-info-size">Size: [[formatBytes(fileInfo.size)]]</div>
			</div>
		</template>
    </template>
</dom-module>

<script>
    class VoidView extends Polymer.Element {
        static get is() { return "void-view"; }

		get properties() {
			return {
				"hash": String
			}
		}
		
        constructor() {
			super();
			this.formatBytes = Util.formatBytes;
        }

        ready() {
			super.ready();
			if(location.search.indexOf('?captcha') === 0){
				doCaptcha(this);
				this.isCaptcha = true;
			} else {
				API.getFileInfo(this.hash.substring(1), function(data) {
					this.self.fileInfo = data.file;
					if(data.captcha) {
						doCaptcha(this.self);
						this.self.isCaptcha = true;
					}else{
						this.self.isCaptcha = false;
						this.self.isImage = (this.self.fileInfo.mime.match(/^image\/(png|jpg|jpeg|gif|bmp)$/gi) !== null);
						this.self.isVideo = (this.self.fileInfo.mime.match(/^video\/(mp4|mkv|avi|m4v)$/gi) !== null);
						this.self.isSound = (this.self.fileInfo.mime.match(/^audio\/(mp3|ogg|flac|wav|alac)$/gi) !== null);
						this.self.isDefault = !this.self.isImage && !this.self.isVideo && !this.self.isSound;
					}
				}.bind({ self: this }));
            }
        }
    }
    customElements.define(VoidView.is, VoidView)
</script>